name: non-existent-css-vars

on: pull_request

concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true

defaults:
    run:
        shell: bash

jobs:
    variant:
        uses: ./.github/workflows/variant.yml

    search-vars:
        name: search non-existent css vars
        needs: [variant]
        strategy:
            matrix:
                include: ${{ fromJson(needs.variant.outputs.result) }}
        env:
            CORE_COMPONENTS_VARIANT: ${{ matrix.variant }}
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v5

            - name: apply patch
              run: |
                  PATCH_SOURCE='variants/${{ matrix.variant }}.patch'

                  if [ -f "$PATCH_SOURCE" ]; then
                      git apply "$PATCH_SOURCE"
                  fi

            - uses: ./.github/actions/ci-setup

            - name: run build
              env:
                  BUILD_WITHOUT_CSS_VARS: 'true'
                  BUILD_CONCURRENCY: 4
                  BUILD_MODERN_ONLY: 'true'
              run: |
                  yarn build

            - name: search
              run: yarn non-existent-css-vars
