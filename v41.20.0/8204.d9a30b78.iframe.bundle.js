"use strict";(self.webpackChunk_alfalab_core_components=self.webpackChunk_alfalab_core_components||[]).push([[8204],{"./packages/confirmation-v1/src/component.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{C:function(){return ConfirmationV1}});var slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react=__webpack_require__("./node_modules/react/index.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),modern=__webpack_require__("./dist/button/modern/index.js"),link_modern=__webpack_require__("./dist/link/modern/index.js"),components=__webpack_require__("./packages/confirmation-v1/src/components/index.ts"),index_module={component:"component_mU8xL",error:"error_fAMFo",errorHeader:"errorHeader_F_0G4",errorText:"errorText_TCLue",phoneHintWrap:"phoneHintWrap_FU8L2",phoneHintText:"phoneHintText_KixaP",phonesWrap:"phonesWrap_a2gOY",phoneWrap:"phoneWrap_burG5",phoneDescription:"phoneDescription_tbkwr",center:"center_w15SC"},jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),ConfirmationV1=(0,react.forwardRef)((function(_ref,ref){var additionalContent=_ref.additionalContent,className=_ref.className,_ref$countdownDuratio=_ref.countdownDuration,countdownDuration=void 0===_ref$countdownDuratio?6e4:_ref$countdownDuratio,dataTestId=_ref.dataTestId,errorIsFatal=_ref.errorIsFatal,_ref$errorTitle=_ref.errorTitle,errorTitle=void 0===_ref$errorTitle?"Превышено количество попыток ввода кода":_ref$errorTitle,_ref$error=_ref.error,error=void 0!==_ref$error&&_ref$error,_ref$errorOverlimit=_ref.errorOverlimit,errorOverlimit=void 0!==_ref$errorOverlimit&&_ref$errorOverlimit,_ref$errorOverlimitIs=_ref.errorOverlimitIsFatal,errorOverlimitIsFatal=void 0!==_ref$errorOverlimitIs&&_ref$errorOverlimitIs,errorText=_ref.errorText,_ref$hasPhoneMask=_ref.hasPhoneMask,hasPhoneMask=void 0===_ref$hasPhoneMask||_ref$hasPhoneMask,_ref$hasSmsCountdown=_ref.hasSmsCountdown,hasSmsCountdown=void 0===_ref$hasSmsCountdown||_ref$hasSmsCountdown,phone=_ref.phone,_ref$requiredCharAmou=_ref.requiredCharAmount,requiredCharAmount=void 0===_ref$requiredCharAmou?5:_ref$requiredCharAmou,_ref$signTitle=_ref.signTitle,signTitle=void 0===_ref$signTitle?"Введите код из сообщения":_ref$signTitle,_ref$overlimitTitle=_ref.overlimitTitle,overlimitTitle=void 0===_ref$overlimitTitle?"Превышено количество\n попыток ввода кода":_ref$overlimitTitle,_ref$overlimitText=_ref.overlimitText,overlimitText=void 0===_ref$overlimitText?"Повторное подтверждение кодом из SMS\n будет возможно через":_ref$overlimitText,overlimitCountdownDuration=_ref.overlimitCountdownDuration,code=_ref.code,_ref$codeSending=_ref.codeSending,codeSending=void 0!==_ref$codeSending&&_ref$codeSending,_ref$codeChecking=_ref.codeChecking,codeChecking=void 0!==_ref$codeChecking&&_ref$codeChecking,_ref$codeCheckingText=_ref.codeCheckingText,codeCheckingText=void 0===_ref$codeCheckingText?"Проверка кода":_ref$codeCheckingText,_ref$codeSendingText=_ref.codeSendingText,codeSendingText=void 0===_ref$codeSendingText?"Отправляем код":_ref$codeSendingText,_ref$buttonErrorText=_ref.buttonErrorText,buttonErrorText=void 0===_ref$buttonErrorText?"Понятно":_ref$buttonErrorText,_ref$buttonReturnText=_ref.buttonReturnText,buttonReturnText=void 0===_ref$buttonReturnText?"Вернуться назад":_ref$buttonReturnText,_ref$buttonRetryText=_ref.buttonRetryText,buttonRetryText=void 0===_ref$buttonRetryText?"Запросить новый код":_ref$buttonRetryText,_ref$alignContent=_ref.alignContent,alignContent=void 0===_ref$alignContent?"left":_ref$alignContent,noAttemptsLeftMessage=_ref.noAttemptsLeftMessage,countdownContent=_ref.countdownContent,onInputFinished=_ref.onInputFinished,onSmsRetryClick=_ref.onSmsRetryClick,onOverlimitSmsRetryClick=_ref.onOverlimitSmsRetryClick,onActionWithFatalError=_ref.onActionWithFatalError,onCountdownFinished=_ref.onCountdownFinished,onOverlimitCountdownFinished=_ref.onOverlimitCountdownFinished,onInputChange=_ref.onInputChange,onSmsHintLinkClick=_ref.onSmsHintLinkClick,_useState=(0,react.useState)(!1),_useState2=(0,slicedToArray.Z)(_useState,2),showHint=_useState2[0],setShowHint=_useState2[1],shouldShowFatalError=errorIsFatal&&Boolean(errorText),shouldShowOverlimitError=!errorIsFatal&&!showHint&&errorOverlimit,shouldShowSignComponent=!showHint&&!shouldShowFatalError&&!shouldShowOverlimitError,shouldShowHint=showHint&&!shouldShowFatalError&&!shouldShowOverlimitError,nonFatalError=errorIsFatal?"":errorText,inputRef=(0,react.useRef)(null),handleSmsRetryClick=(0,react.useCallback)((function(){onSmsRetryClick()}),[onSmsRetryClick]),handleOverlimitSmsRetryClick=(0,react.useCallback)((function(){onOverlimitSmsRetryClick&&onOverlimitSmsRetryClick()}),[onOverlimitSmsRetryClick]),handleSmsRetryFromHintClick=(0,react.useCallback)((function(){setShowHint(!1),noAttemptsLeftMessage||onSmsRetryClick()}),[onSmsRetryClick,noAttemptsLeftMessage]),handleCountdownFinished=(0,react.useCallback)((function(){onCountdownFinished&&onCountdownFinished()}),[onCountdownFinished]),handleOverlimitCountdownFinished=(0,react.useCallback)((function(){onOverlimitCountdownFinished&&onOverlimitCountdownFinished()}),[onOverlimitCountdownFinished]),handleSmsHintLinkClick=(0,react.useCallback)((function(){setShowHint(!0),onSmsHintLinkClick&&onSmsHintLinkClick()}),[onSmsHintLinkClick]),handleErrorSmsRetryClick=(0,react.useCallback)((function(){onActionWithFatalError?onActionWithFatalError():onSmsRetryClick()}),[onActionWithFatalError,onSmsRetryClick]);return(0,react.useEffect)((function(){inputRef.current&&inputRef.current.focus()}),[]),(0,jsx_runtime.jsxs)("div",{className:classnames_default()(index_module.component,index_module[alignContent],className),ref:ref,"data-test-id":dataTestId,children:[shouldShowSignComponent&&(0,jsx_runtime.jsx)(components.s$,{codeChecking:codeChecking,codeSending:codeSending,smsHintVisible:!codeChecking,additionalContent:additionalContent,requiredCharAmount:requiredCharAmount,hasSmsCountdown:hasSmsCountdown,countdownDuration:countdownDuration,phone:phone,code:code,hasPhoneMask:hasPhoneMask,errorText:nonFatalError||"",error:error,title:signTitle,buttonRetryText:buttonRetryText,inputRef:inputRef,codeCheckingText:codeCheckingText,codeSendingText:codeSendingText,alignContent:alignContent,noAttemptsLeftMessage:noAttemptsLeftMessage,countdownContent:countdownContent,onInputFinished:onInputFinished,onInputChange:onInputChange,onSmsRetryClick:handleSmsRetryClick,onCountdownFinished:handleCountdownFinished,onSmsHintLinkClick:handleSmsHintLinkClick}),shouldShowOverlimitError&&(0,jsx_runtime.jsx)(components.Tc,{duration:overlimitCountdownDuration,title:overlimitTitle,text:overlimitText,hasFatalError:errorOverlimitIsFatal,buttonRetryText:buttonRetryText,onOverlimitRepeatSms:handleOverlimitSmsRetryClick,onOverlimitCountdownFinished:handleOverlimitCountdownFinished}),shouldShowFatalError&&(0,jsx_runtime.jsxs)("div",{className:index_module.error,role:"alert",children:[(0,jsx_runtime.jsx)("span",{className:index_module.errorHeader,children:errorTitle}),(0,jsx_runtime.jsx)("span",{className:index_module.errorText,children:errorText}),(0,jsx_runtime.jsx)(modern.Button,{size:"xs",view:"secondary",onClick:handleErrorSmsRetryClick,children:buttonErrorText})]}),shouldShowHint&&(0,jsx_runtime.jsxs)("div",{className:index_module.phoneHintWrap,children:[(0,jsx_runtime.jsx)("span",{className:index_module.errorHeader,children:"Не приходит сообщение?"}),(0,jsx_runtime.jsx)("span",{className:index_module.phoneHintText,children:"Если у вас сменился номер телефона, пожалуйста, обратитесь в любое отделение банка."}),(0,jsx_runtime.jsxs)("div",{className:index_module.phonesWrap,children:[(0,jsx_runtime.jsxs)("div",{className:index_module.phoneWrap,children:[(0,jsx_runtime.jsx)(link_modern.Link,{className:index_module.phoneLink,href:"tel:+78002000000",children:"8 800 200-00-00"}),(0,jsx_runtime.jsxs)("span",{className:index_module.phoneDescription,children:[" ","— для звонков по России"]})]}),(0,jsx_runtime.jsxs)("div",{className:index_module.phoneWrap,children:[(0,jsx_runtime.jsx)(link_modern.Link,{className:index_module.phoneLink,href:"tel:+74957888878",children:"+7 495 788-88-78"}),(0,jsx_runtime.jsxs)("span",{className:index_module.phoneDescription,children:[" ","— в Москве и за границей"]})]})]}),(0,jsx_runtime.jsx)(modern.Button,{className:index_module.repeatButton,size:"xs",view:"secondary",onClick:handleSmsRetryFromHintClick,children:buttonReturnText})]})]})}));ConfirmationV1.defaultProps={countdownDuration:6e4,errorTitle:"Превышено количество попыток ввода кода",hasPhoneMask:!0,hasSmsCountdown:!0,requiredCharAmount:5,signTitle:"Введите код из сообщения",codeSending:!1,codeChecking:!1,codeCheckingText:"Проверка кода",codeSendingText:"Отправляем код",buttonErrorText:"Понятно",buttonReturnText:"Вернуться назад",buttonRetryText:"Запросить новый код",alignContent:"left"};try{ConfirmationV1.displayName="ConfirmationV1",ConfirmationV1.__docgenInfo={description:"",displayName:"ConfirmationV1",props:{code:{defaultValue:null,description:"Значение поля ввода",name:"code",required:!0,type:{name:"string"}},codeChecking:{defaultValue:{value:"false"},description:"Флаг состояния обработки введенного кода.",name:"codeChecking",required:!1,type:{name:"boolean"}},codeSending:{defaultValue:{value:"false"},description:"Флаг состояния отправки кода.",name:"codeSending",required:!1,type:{name:"boolean"}},error:{defaultValue:{value:"false"},description:"Состояние ошибки подписания",name:"error",required:!1,type:{name:"boolean"}},errorOverlimit:{defaultValue:{value:"false"},description:"Состояние ошибки лимитов - превышено кол-во попыток ввода или запросов кода",name:"errorOverlimit",required:!1,type:{name:"boolean"}},errorOverlimitIsFatal:{defaultValue:{value:"false"},description:"Состояние критической ошибки лимитов - превышены все лимиты и попытки, пользователя блокируют",name:"errorOverlimitIsFatal",required:!1,type:{name:"boolean"}},errorText:{defaultValue:null,description:"Текст ошибки подписания",name:"errorText",required:!1,type:{name:"string"}},additionalContent:{defaultValue:null,description:"Дополнительный контент",name:"additionalContent",required:!1,type:{name:"ReactNode"}},errorIsFatal:{defaultValue:null,description:'Флаг критичности ошибки подписания.\nЕсли true - ошибка подписания рисуется на экране без поля ввода, но с кнопкой "Запросить код"\nЕсли false - ошибка подписания рисуется под полем ввода кода',name:"errorIsFatal",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"Дополнительный класс",name:"className",required:!1,type:{name:"string"}},phone:{defaultValue:null,description:"Номер телефона, на который отправляется сообщение.",name:"phone",required:!1,type:{name:"string"}},hasPhoneMask:{defaultValue:{value:"true"},description:"Управление необходимостью маскировать номер телефона",name:"hasPhoneMask",required:!1,type:{name:"boolean"}},requiredCharAmount:{defaultValue:{value:"5"},description:"Количество символов, которое можно ввести в поле ввода подписания до того, как произойдет автоотправка",name:"requiredCharAmount",required:!1,type:{name:"number"}},hasSmsCountdown:{defaultValue:{value:"true"},description:'Управление отображением таймера с кнопкой "Запросить код"',name:"hasSmsCountdown",required:!1,type:{name:"boolean"}},countdownDuration:{defaultValue:{value:"60000"},description:"Длительность обратного отсчета на кнопке повторного запроса сообщения, в милисекундах",name:"countdownDuration",required:!1,type:{name:"number"}},signTitle:{defaultValue:{value:"Введите код из сообщения"},description:"Заголовок экрана подписания",name:"signTitle",required:!1,type:{name:"ReactNode"}},overlimitTitle:{defaultValue:{value:"Превышено количество\n попыток ввода кода"},description:"Заголовок экрана ошибки лимитов",name:"overlimitTitle",required:!1,type:{name:"string"}},overlimitText:{defaultValue:{value:"Повторное подтверждение кодом из SMS\n будет возможно через"},description:"Текстовое описание блокировки формы при превышении лимитов",name:"overlimitText",required:!1,type:{name:"string"}},overlimitCountdownDuration:{defaultValue:null,description:"Длительно блокировки при превышении лимитов, в милисекундах",name:"overlimitCountdownDuration",required:!1,type:{name:"number"}},errorTitle:{defaultValue:{value:"Превышено количество попыток ввода кода"},description:"Заголовок экрана блокирующей ошибки",name:"errorTitle",required:!1,type:{name:"string"}},dataTestId:{defaultValue:null,description:"Идентификатор для систем автоматизированного тестирования",name:"dataTestId",required:!1,type:{name:"string"}},codeCheckingText:{defaultValue:{value:"Проверка кода"},description:"Текст лоадера при проверке кода",name:"codeCheckingText",required:!1,type:{name:"string"}},codeSendingText:{defaultValue:{value:"Отправляем код"},description:"Текст лоадера при отправке кода",name:"codeSendingText",required:!1,type:{name:"string"}},buttonErrorText:{defaultValue:{value:"Понятно"},description:"Текст кнопки при блокирующей ошибке",name:"buttonErrorText",required:!1,type:{name:"string"}},buttonReturnText:{defaultValue:{value:"Вернуться назад"},description:'Текст кнопки "Вернуться назад" на экране помощи',name:"buttonReturnText",required:!1,type:{name:"string"}},buttonRetryText:{defaultValue:{value:"Запросить новый код"},description:'Текст кнопки "Запросить новый код"',name:"buttonRetryText",required:!1,type:{name:"string"}},alignContent:{defaultValue:{value:"left"},description:"Позиционирование контента",name:"alignContent",required:!1,type:{name:"enum",value:[{value:'"left"'},{value:'"center"'}]}},noAttemptsLeftMessage:{defaultValue:null,description:"Сообщение, если не осталось попыток ввода кода.\nКнопка повторной отправки смс при этом скрывается.",name:"noAttemptsLeftMessage",required:!1,type:{name:"string"}},countdownContent:{defaultValue:null,description:"Кастомный контент для компонента Countdown",name:"countdownContent",required:!1,type:{name:"ReactNode"}},onInputFinished:{defaultValue:null,description:"Обработчик события завершения ввода кода подписания",name:"onInputFinished",required:!0,type:{name:"({ code }: { code: string; }) => void"}},onInputChange:{defaultValue:null,description:"Обработчик события изменения значения поля ввода кода подписания",name:"onInputChange",required:!0,type:{name:"({ code }: { code: string; }) => void"}},onSmsRetryClick:{defaultValue:null,description:'Обработчик события нажатия на кнопку "Запросить код"',name:"onSmsRetryClick",required:!0,type:{name:"() => void"}},onOverlimitSmsRetryClick:{defaultValue:null,description:'Обработчик события нажатия на кнопку "Запросить код" в блоке превышение лимитов',name:"onOverlimitSmsRetryClick",required:!1,type:{name:"(() => void)"}},onCountdownFinished:{defaultValue:null,description:"Обработчик события завершения обратного отсчета для повторного запроса сообщения",name:"onCountdownFinished",required:!1,type:{name:"(() => void)"}},onOverlimitCountdownFinished:{defaultValue:null,description:"Обработчик события завершения обратного отсчета для блокировки формы",name:"onOverlimitCountdownFinished",required:!1,type:{name:"(() => void)"}},onSmsHintLinkClick:{defaultValue:null,description:'Обработчик события нажатия на ссылку "не приходит сообщение?"',name:"onSmsHintLinkClick",required:!1,type:{name:"(() => void)"}},onActionWithFatalError:{defaultValue:null,description:'Обработчик события нажатия на кнопку buttonErrorText (по дефолту "Понятно"), которая появляется при критической ошибке.\nЕсли не передан, то вызывается onSmsRetryClick',name:"onActionWithFatalError",required:!1,type:{name:"(() => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/confirmation-v1/src/component.tsx#ConfirmationV1"]={docgenInfo:ConfirmationV1.__docgenInfo,name:"ConfirmationV1",path:"packages/confirmation-v1/src/component.tsx#ConfirmationV1"})}catch(__react_docgen_typescript_loader_error){}},"./packages/confirmation-v1/src/components/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{IT:function(){return Countdown},Pw:function(){return CountdownLoader},Tc:function(){return Overlimit},s$:function(){return SignConfirmation},Ih:function(){return formatMsAsMinutes}});var slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),defineProperty=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),react=__webpack_require__("./node_modules/react/index.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),modern=__webpack_require__("./dist/button/modern/index.js"),esm=__webpack_require__("./node_modules/@alfalab/hooks/dist/esm/index.js"),dist_esm=__webpack_require__("./node_modules/@alfalab/utils/dist/esm/index.js"),index_module_circle="circle_Fz6NA",jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),CIRCUMFERENCE=7*Math.PI*2,CountdownLoader=function CountdownLoader(_ref){var progress=_ref.progress,className=_ref.className,value=Math.min(progress,1),strokeDasharray=CIRCUMFERENCE.toFixed(2),strokeDashoffset=(value*CIRCUMFERENCE).toFixed(2);return(0,jsx_runtime.jsx)("svg",{width:16,height:16,viewBox:"0 0 ".concat(16," ").concat(16),className:className,children:(0,jsx_runtime.jsx)("circle",{cx:8,cy:8,r:7,strokeDasharray:strokeDasharray,strokeDashoffset:strokeDashoffset,transform:"rotate(-90 ".concat(8," ").concat(8,")"),className:index_module_circle})})};try{CountdownLoader.displayName="CountdownLoader",CountdownLoader.__docgenInfo={description:"",displayName:"CountdownLoader",props:{progress:{defaultValue:null,description:"",name:"progress",required:!0,type:{name:"number"}},className:{defaultValue:null,description:"",name:"className",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/confirmation-v1/src/components/countdown-loader/component.tsx#CountdownLoader"]={docgenInfo:CountdownLoader.__docgenInfo,name:"CountdownLoader",path:"packages/confirmation-v1/src/components/countdown-loader/component.tsx#CountdownLoader"})}catch(__react_docgen_typescript_loader_error){}var countdown_index_module={component:"component_f0pPW",hasError:"hasError_v4ATZ",getCodeButton:"getCodeButton_QZaYZ",info:"info_gZzo7",customContent:"customContent_b76Kh",loaderWrap:"loaderWrap_Aym2P",loader:"loader_TDeBX",center:"center_XXeFJ",timePassed:"timePassed_X21OC",noAttemptsLeftMessage:"noAttemptsLeftMessage_jo7XJ"};function formatMsAsMinutes(ms){var totalSeconds=Math.ceil(ms/1e3),totalMinutes=Math.floor(totalSeconds/60),totalHours=Math.floor(totalMinutes/60),paddedSeconds="00".concat(totalSeconds%60).slice(-2);if(totalHours>0){var _paddedMinutes="00".concat(totalMinutes%60).slice(-2),paddedHours="00".concat(totalHours).slice(-2);return"".concat(paddedHours,":").concat(_paddedMinutes,":").concat(paddedSeconds)}var paddedMinutes="00".concat(totalMinutes).slice(-2);return"".concat(paddedMinutes,":").concat(paddedSeconds)}var Container=function Container(_ref){var alignContent=_ref.alignContent,hasError=_ref.hasError,children=_ref.children;return(0,jsx_runtime.jsx)("div",{className:classnames_default()(countdown_index_module.component,countdown_index_module[alignContent],(0,defineProperty.Z)({},countdown_index_module.hasError,hasError)),children:children})},Countdown=function Countdown(_ref2){var _ref2$duration=_ref2.duration,duration=void 0===_ref2$duration?5e3:_ref2$duration,_ref2$phone=_ref2.phone,phone=void 0===_ref2$phone?"":_ref2$phone,_ref2$hasPhoneMask=_ref2.hasPhoneMask,hasPhoneMask=void 0===_ref2$hasPhoneMask||_ref2$hasPhoneMask,buttonRetryText=_ref2.buttonRetryText,alignContent=_ref2.alignContent,noAttemptsLeftMessage=_ref2.noAttemptsLeftMessage,hasError=_ref2.hasError,content=_ref2.content,onRepeatSms=_ref2.onRepeatSms,onCountdownFinished=_ref2.onCountdownFinished,timerId=(0,react.useRef)(0),start=(0,react.useRef)(0),_useState=(0,react.useState)(!1),_useState2=(0,slicedToArray.Z)(_useState,2),repeatSmsButtonShow=_useState2[0],setRepeatSmsButtonShow=_useState2[1],_useState3=(0,react.useState)(0),_useState4=(0,slicedToArray.Z)(_useState3,2),timePassed=_useState4[0],setTimePassed=_useState4[1],noAttemptsLeftMessagePrev=(0,esm.D9)(noAttemptsLeftMessage),stopTimer=(0,react.useCallback)((function(){window.clearInterval(timerId.current)}),[]),updateProgress=(0,react.useCallback)((function(){var passed=Date.now()-start.current;passed>=duration?(setRepeatSmsButtonShow(!0),onCountdownFinished&&onCountdownFinished(),stopTimer()):setTimePassed(passed)}),[duration,onCountdownFinished,stopTimer]),startTimer=(0,react.useCallback)((function(){start.current=Date.now(),updateProgress(),timerId.current=window.setInterval(updateProgress,50)}),[updateProgress]),handleRepeatSmsButtonClick=(0,react.useCallback)((function(event){setRepeatSmsButtonShow(!1),onRepeatSms&&onRepeatSms(event),startTimer()}),[onRepeatSms,startTimer]);(0,react.useEffect)((function(){return startTimer(),function(){stopTimer()}}),[startTimer,stopTimer]),(0,react.useEffect)((function(){!noAttemptsLeftMessagePrev&&noAttemptsLeftMessage&&stopTimer()}),[noAttemptsLeftMessage,noAttemptsLeftMessagePrev,stopTimer]);var progress=timePassed/duration,formattedPhone=dist_esm.jM.format(phone),retryButton=(0,jsx_runtime.jsx)(modern.Button,{size:"xs",view:"secondary",onClick:handleRepeatSmsButtonClick,className:countdown_index_module.getCodeButton,children:buttonRetryText});return content?(0,jsx_runtime.jsxs)(Container,{alignContent:alignContent,hasError:hasError,children:[(0,jsx_runtime.jsx)("div",{className:countdown_index_module.customContent,children:content}),retryButton]}):(0,jsx_runtime.jsxs)(Container,{alignContent:alignContent,hasError:hasError,children:[phone&&!hasError&&(0,jsx_runtime.jsxs)("div",{children:["Код отправлен на"," ",hasPhoneMask?dist_esm.jM.mask(formattedPhone):formattedPhone]}),noAttemptsLeftMessage?(0,jsx_runtime.jsx)("div",{className:countdown_index_module.noAttemptsLeftMessage,children:noAttemptsLeftMessage}):repeatSmsButtonShow?retryButton:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:countdown_index_module.info,children:"Запросить повторно можно через"}),(0,jsx_runtime.jsxs)("div",{className:countdown_index_module.loaderWrap,children:[(0,jsx_runtime.jsx)(CountdownLoader,{progress:progress,className:countdown_index_module.loader}),(0,jsx_runtime.jsx)("div",{className:countdown_index_module.timePassed,children:formatMsAsMinutes(duration-timePassed)})]})]})]})};try{formatMsAsMinutes.displayName="formatMsAsMinutes",formatMsAsMinutes.__docgenInfo={description:"TODO: Вынести это в utils\nФорматирование миллисекунд в hh:mm:ss.",displayName:"formatMsAsMinutes",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/confirmation-v1/src/components/countdown/component.tsx#formatMsAsMinutes"]={docgenInfo:formatMsAsMinutes.__docgenInfo,name:"formatMsAsMinutes",path:"packages/confirmation-v1/src/components/countdown/component.tsx#formatMsAsMinutes"})}catch(__react_docgen_typescript_loader_error){}try{Countdown.displayName="Countdown",Countdown.__docgenInfo={description:"",displayName:"Countdown",props:{duration:{defaultValue:{value:"5000"},description:"",name:"duration",required:!1,type:{name:"number"}},hasPhoneMask:{defaultValue:{value:"true"},description:"",name:"hasPhoneMask",required:!1,type:{name:"boolean"}},phone:{defaultValue:{value:""},description:"",name:"phone",required:!1,type:{name:"string"}},alignContent:{defaultValue:null,description:"",name:"alignContent",required:!0,type:{name:"string"}},buttonRetryText:{defaultValue:null,description:"",name:"buttonRetryText",required:!0,type:{name:"string"}},noAttemptsLeftMessage:{defaultValue:null,description:"",name:"noAttemptsLeftMessage",required:!1,type:{name:"string"}},hasError:{defaultValue:null,description:"",name:"hasError",required:!0,type:{name:"boolean"}},content:{defaultValue:null,description:"",name:"content",required:!1,type:{name:"ReactNode"}},onCountdownFinished:{defaultValue:null,description:"",name:"onCountdownFinished",required:!1,type:{name:"(() => void)"}},onRepeatSms:{defaultValue:null,description:"",name:"onRepeatSms",required:!0,type:{name:"(event: MouseEvent<Element, MouseEvent>) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/confirmation-v1/src/components/countdown/component.tsx#Countdown"]={docgenInfo:Countdown.__docgenInfo,name:"Countdown",path:"packages/confirmation-v1/src/components/countdown/component.tsx#Countdown"})}catch(__react_docgen_typescript_loader_error){}var link_modern=__webpack_require__("./dist/link/modern/index.js"),loader_modern=__webpack_require__("./dist/loader/modern/index.js"),toConsumableArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),code_input_index_module={component:"component_TOs9_",input:"input_rkFQ2",hasError:"hasError_VUtp4",center:"center_xuNlf",disabled:"disabled_RZBJ6",compact:"compact_biQFs",shake:"shake_jrRT6"},Input=function Input(_ref){var _cn,index=_ref.index,slotsCount=_ref.slotsCount,error=_ref.error,processing=_ref.processing,value=_ref.value,alignContent=_ref.alignContent,handleChange=_ref.handleChange,handleInputKeyDown=_ref.handleInputKeyDown,setRef=_ref.setRef,focus=_ref.focus,splittedValue=value.split(""),inputRef=(0,react.useRef)(null);return(0,jsx_runtime.jsx)("input",{className:classnames_default()(code_input_index_module.input,code_input_index_module[alignContent],(_cn={},(0,defineProperty.Z)(_cn,code_input_index_module.hasError,error),(0,defineProperty.Z)(_cn,code_input_index_module.disabled,processing),_cn)),disabled:processing,value:splittedValue[index]||"",autoComplete:0===index?"one-time-code":"",inputMode:"numeric",pattern:"[0-9]*",onChange:function onChange(event){var targetValue=event.target.value;if(/^\d$/.test(targetValue)){var newValues=(0,toConsumableArray.Z)(splittedValue);newValues[index]=targetValue,handleChange(newValues.join(""))}else if(/^\d{1,}$/.test(targetValue)&&index!==slotsCount-1){var _newValues=function mergeArrays(_ref){var sourceArray=_ref.sourceArray,targetArray=_ref.targetArray,startIndex=_ref.startIndex,resultArrayLength=_ref.resultArrayLength,insertedElemIndex=0;return new Array(resultArrayLength).fill("").map((function(_,index){return index<startIndex?sourceArray[index]||"":targetArray[insertedElemIndex++]||sourceArray[index]||""}))}({sourceArray:splittedValue,targetArray:targetValue.split(""),startIndex:index,resultArrayLength:slotsCount});handleChange(_newValues.join(""))}},onKeyDown:function onInputKeyDown(event){var key=event.key,newValues=(0,toConsumableArray.Z)(splittedValue);switch(key){case"Backspace":case"Delete":newValues[index]="",handleChange(newValues.join("").trim()),0!==index&&focus(index-1);break;case"ArrowRight":index!==slotsCount-1&&focus(index+1);break;case"ArrowLeft":0!==index&&focus(index-1);break;case"Home":focus(0);break;case"End":focus(slotsCount-1)}handleInputKeyDown(event)},ref:function handleRef(node){inputRef.current=node,setRef({node:node,index:index})}})},CodeInput=(0,react.forwardRef)((function(_ref2,ref){var _cn2,processing=_ref2.processing,_ref2$value=_ref2.value,value=void 0===_ref2$value?"":_ref2$value,slotsCount=_ref2.slotsCount,error=_ref2.error,handleInputKeyDown=_ref2.handleInputKeyDown,handleChange=_ref2.handleChange,className=_ref2.className,alignContent=_ref2.alignContent,inputs=(0,react.useRef)([]);(0,react.useImperativeHandle)(ref,(function(){return inputs.current[0]}));var prevValue=(0,esm.D9)(value)||"",focus=(0,react.useCallback)((function(index){var input=inputs.current[index];input&&(input.focus(),input.setSelectionRange(1,1))}),[]),setRef=(0,react.useCallback)((function(_ref3){var node=_ref3.node,index=_ref3.index;inputs.current[index]=node}),[]);return(0,react.useEffect)((function(){var inputIndex=value.length===slotsCount?value.length-1:value.length;(!processing||error)&&value.length===prevValue.length&&focus(inputIndex)}),[focus,error,slotsCount,value.length,prevValue.length,processing]),(0,react.useEffect)((function(){if(value.length>prevValue.length&&value.length<slotsCount){var nextInputIndex=value.length;focus(nextInputIndex)}else if(value.length<=prevValue.length&&value.length>0){var _nextInputIndex=value.length-1;focus(_nextInputIndex)}}),[value.length,prevValue.length,slotsCount,focus]),(0,jsx_runtime.jsx)("div",{className:classnames_default()(code_input_index_module.component,className,(_cn2={},(0,defineProperty.Z)(_cn2,code_input_index_module.shake,Boolean(error)),(0,defineProperty.Z)(_cn2,code_input_index_module.compact,slotsCount>6),_cn2)),children:new Array(slotsCount).fill("").map((function(_,index){return(0,jsx_runtime.jsx)(Input,{value:value,index:index,error:error,processing:processing,slotsCount:slotsCount,alignContent:alignContent,handleChange:handleChange,handleInputKeyDown:handleInputKeyDown,setRef:setRef,focus:focus},index)}))})}));try{CodeInput.displayName="CodeInput",CodeInput.__docgenInfo={description:"",displayName:"CodeInput",props:{processing:{defaultValue:null,description:"",name:"processing",required:!0,type:{name:"boolean"}},value:{defaultValue:{value:""},description:"",name:"value",required:!1,type:{name:"string"}},slotsCount:{defaultValue:null,description:"",name:"slotsCount",required:!0,type:{name:"number"}},error:{defaultValue:null,description:"",name:"error",required:!0,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},alignContent:{defaultValue:null,description:"",name:"alignContent",required:!0,type:{name:"enum",value:[{value:'"left"'},{value:'"center"'}]}},handleChange:{defaultValue:null,description:"",name:"handleChange",required:!0,type:{name:"(code: string) => void"}},handleInputKeyDown:{defaultValue:null,description:"",name:"handleInputKeyDown",required:!0,type:{name:"(event: KeyboardEvent<Element>) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/confirmation-v1/src/components/code-input/component.tsx#CodeInput"]={docgenInfo:CodeInput.__docgenInfo,name:"CodeInput",path:"packages/confirmation-v1/src/components/code-input/component.tsx#CodeInput"})}catch(__react_docgen_typescript_loader_error){}var sign_confirmation_index_module={component:"component_Qgj7w",countdown:"countdown_NvqnP",hidden:"hidden_ou2yh",header:"header_GLygM",inputContainer:"inputContainer_SXsbR",smsComeLinkWrap:"smsComeLinkWrap_jpnlZ",smsComeLink:"smsComeLink_3eS4L",error:"error_HZZRe",loaderWrap:"loaderWrap_js2cR",loaderText:"loaderText_sK5e1",center:"center_dGZ5p",codeInput:"codeInput_fy8mz"},SignConfirmation=function SignConfirmation(_ref){var codeChecking=_ref.codeChecking,codeSending=_ref.codeSending,smsHintVisible=_ref.smsHintVisible,requiredCharAmount=_ref.requiredCharAmount,countdownDuration=_ref.countdownDuration,additionalContent=_ref.additionalContent,hasPhoneMask=_ref.hasPhoneMask,phone=_ref.phone,inputValue=_ref.code,error=_ref.error,errorText=_ref.errorText,title=_ref.title,hasSmsCountdown=_ref.hasSmsCountdown,inputRef=_ref.inputRef,codeCheckingText=_ref.codeCheckingText,codeSendingText=_ref.codeSendingText,alignContent=_ref.alignContent,noAttemptsLeftMessage=_ref.noAttemptsLeftMessage,buttonRetryText=_ref.buttonRetryText,countdownContent=_ref.countdownContent,onInputFinished=_ref.onInputFinished,onInputChange=_ref.onInputChange,onSmsRetryClick=_ref.onSmsRetryClick,onCountdownFinished=_ref.onCountdownFinished,onSmsHintLinkClick=_ref.onSmsHintLinkClick,processing=codeChecking||codeSending,displayedError=processing?"":errorText,handleInputKeyDown=(0,react.useCallback)((function(event){"Enter"===event.key&&onInputFinished({code:event.target.value})}),[onInputFinished]),handleInputFinished=(0,react.useCallback)((function(code){onInputFinished({code:code}),inputRef.current&&inputRef.current.blur()}),[onInputFinished,inputRef]),handleInputChange=(0,react.useCallback)((function(code){code.length===requiredCharAmount&&handleInputFinished(code),onInputChange({code:code})}),[handleInputFinished,onInputChange,requiredCharAmount]);return(0,jsx_runtime.jsxs)("div",{className:classnames_default()(sign_confirmation_index_module.component,sign_confirmation_index_module[alignContent]),children:["string"==typeof title?(0,jsx_runtime.jsx)("span",{className:sign_confirmation_index_module.header,children:title}):title,(0,jsx_runtime.jsxs)("div",{className:sign_confirmation_index_module.inputContainer,children:[(0,jsx_runtime.jsx)(CodeInput,{processing:processing,error:error,value:inputValue,ref:inputRef,slotsCount:requiredCharAmount,className:sign_confirmation_index_module.codeInput,alignContent:alignContent,handleChange:handleInputChange,handleInputKeyDown:handleInputKeyDown}),displayedError&&(0,jsx_runtime.jsx)("div",{className:sign_confirmation_index_module.error,role:"alert",children:displayedError})]}),processing&&(0,jsx_runtime.jsxs)("div",{className:sign_confirmation_index_module.loaderWrap,children:[(0,jsx_runtime.jsx)(loader_modern.Loader,{}),(0,jsx_runtime.jsx)("span",{className:sign_confirmation_index_module.loaderText,children:codeChecking?codeCheckingText:codeSendingText})]}),hasSmsCountdown&&(0,jsx_runtime.jsx)("div",{className:classnames_default()("countdown",sign_confirmation_index_module.countdown,(0,defineProperty.Z)({},sign_confirmation_index_module.hidden,processing)),children:(0,jsx_runtime.jsx)(Countdown,{duration:countdownDuration,phone:phone,hasPhoneMask:hasPhoneMask,alignContent:alignContent,noAttemptsLeftMessage:noAttemptsLeftMessage,hasError:Boolean(displayedError),buttonRetryText:buttonRetryText,content:countdownContent,onRepeatSms:onSmsRetryClick,onCountdownFinished:onCountdownFinished})}),smsHintVisible&&(0,jsx_runtime.jsx)("div",{className:sign_confirmation_index_module.smsComeLinkWrap,children:(0,jsx_runtime.jsx)(link_modern.Link,{onClick:onSmsHintLinkClick,className:sign_confirmation_index_module.smsComeLink,view:"secondary",pseudo:!0,children:"Не приходит сообщение?"})}),(0,jsx_runtime.jsx)("div",{children:additionalContent})]})};try{SignConfirmation.displayName="SignConfirmation",SignConfirmation.__docgenInfo={description:"",displayName:"SignConfirmation",props:{codeChecking:{defaultValue:null,description:"",name:"codeChecking",required:!0,type:{name:"boolean"}},codeSending:{defaultValue:null,description:"",name:"codeSending",required:!0,type:{name:"boolean"}},smsHintVisible:{defaultValue:null,description:"",name:"smsHintVisible",required:!0,type:{name:"boolean"}},requiredCharAmount:{defaultValue:null,description:"",name:"requiredCharAmount",required:!0,type:{name:"number"}},countdownDuration:{defaultValue:null,description:"",name:"countdownDuration",required:!0,type:{name:"number"}},additionalContent:{defaultValue:null,description:"",name:"additionalContent",required:!0,type:{name:"ReactNode"}},hasPhoneMask:{defaultValue:null,description:"",name:"hasPhoneMask",required:!0,type:{name:"boolean"}},phone:{defaultValue:null,description:"",name:"phone",required:!1,type:{name:"string"}},code:{defaultValue:null,description:"",name:"code",required:!0,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!0,type:{name:"string"}},error:{defaultValue:null,description:"",name:"error",required:!0,type:{name:"boolean"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"ReactNode"}},codeCheckingText:{defaultValue:null,description:"",name:"codeCheckingText",required:!0,type:{name:"string"}},codeSendingText:{defaultValue:null,description:"",name:"codeSendingText",required:!0,type:{name:"string"}},hasSmsCountdown:{defaultValue:null,description:"",name:"hasSmsCountdown",required:!0,type:{name:"boolean"}},inputRef:{defaultValue:null,description:"",name:"inputRef",required:!0,type:{name:"MutableRefObject<HTMLInputElement | null>"}},alignContent:{defaultValue:null,description:"",name:"alignContent",required:!0,type:{name:"enum",value:[{value:'"left"'},{value:'"center"'}]}},noAttemptsLeftMessage:{defaultValue:null,description:"",name:"noAttemptsLeftMessage",required:!1,type:{name:"string"}},buttonRetryText:{defaultValue:null,description:"",name:"buttonRetryText",required:!0,type:{name:"string"}},countdownContent:{defaultValue:null,description:"",name:"countdownContent",required:!1,type:{name:"ReactNode"}},onInputFinished:{defaultValue:null,description:"",name:"onInputFinished",required:!0,type:{name:"({ code }: { code: string; }) => void"}},onInputChange:{defaultValue:null,description:"",name:"onInputChange",required:!0,type:{name:"({ code }: { code: string; }) => void"}},onSmsRetryClick:{defaultValue:null,description:"",name:"onSmsRetryClick",required:!0,type:{name:"(event: MouseEvent<Element, MouseEvent>) => void"}},onCountdownFinished:{defaultValue:null,description:"",name:"onCountdownFinished",required:!0,type:{name:"() => void"}},onSmsHintLinkClick:{defaultValue:null,description:"",name:"onSmsHintLinkClick",required:!0,type:{name:"(event: MouseEvent<Element, MouseEvent>) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/confirmation-v1/src/components/sign-confirmation/component.tsx#SignConfirmation"]={docgenInfo:SignConfirmation.__docgenInfo,name:"SignConfirmation",path:"packages/confirmation-v1/src/components/sign-confirmation/component.tsx#SignConfirmation"})}catch(__react_docgen_typescript_loader_error){}var CrossCircleMIcon=__webpack_require__("./node_modules/@alfalab/icons-glyph/CrossCircleMIcon.js"),overlimit_index_module_component="component_ewb4j",overlimit_index_module_title="title_F0GNe",overlimit_index_module_description="description_PKKvK",overlimit_index_module_countdown="countdown_CunOQ",overlimit_index_module_loader="loader_Aq7dA",overlimit_index_module_timePassed="timePassed_R3NtM",overlimit_index_module_getCodeButton="getCodeButton_dY3Rl",overlimit_index_module_alertIcon="alertIcon_Mo31l",Overlimit=function Overlimit(_ref){var _ref$duration=_ref.duration,duration=void 0===_ref$duration?6e4:_ref$duration,buttonRetryText=_ref.buttonRetryText,hasFatalError=_ref.hasFatalError,onOverlimitRepeatSms=_ref.onOverlimitRepeatSms,onOverlimitCountdownFinished=_ref.onOverlimitCountdownFinished,text=_ref.text,title=_ref.title,timerId=(0,react.useRef)(0),start=(0,react.useRef)(0),_useState=(0,react.useState)(!1),_useState2=(0,slicedToArray.Z)(_useState,2),isBlockingOver=_useState2[0],setIsBlockingOver=_useState2[1],_useState3=(0,react.useState)(0),_useState4=(0,slicedToArray.Z)(_useState3,2),timePassed=_useState4[0],setTimePassed=_useState4[1],stopTimer=(0,react.useCallback)((function(){window.clearInterval(timerId.current)}),[]),updateProgress=(0,react.useCallback)((function(){var passed=Date.now()-start.current;passed>=duration?(setIsBlockingOver(!0),onOverlimitCountdownFinished&&onOverlimitCountdownFinished(),stopTimer()):setTimePassed(passed)}),[duration,onOverlimitCountdownFinished,stopTimer]),startTimer=(0,react.useCallback)((function(){start.current=Date.now(),updateProgress(),timerId.current=window.setInterval(updateProgress,50)}),[updateProgress]),handleRepeatSmsButtonClick=(0,react.useCallback)((function(event){setIsBlockingOver(!1),onOverlimitRepeatSms&&onOverlimitRepeatSms(event),startTimer()}),[onOverlimitRepeatSms,startTimer]);(0,react.useEffect)((function(){return startTimer(),function(){stopTimer()}}),[startTimer,stopTimer]);var progress=timePassed/duration;return(0,jsx_runtime.jsxs)("div",{className:overlimit_index_module_component,children:[hasFatalError&&(0,jsx_runtime.jsx)("div",{className:overlimit_index_module_alertIcon,children:(0,jsx_runtime.jsx)(CrossCircleMIcon.CrossCircleMIcon,{"data-test-id":"alert-icon",width:64,height:64})}),(0,jsx_runtime.jsx)("span",{className:overlimit_index_module_title,children:title}),(0,jsx_runtime.jsxs)("div",{className:overlimit_index_module_description,children:[(0,jsx_runtime.jsx)("div",{children:text}),isBlockingOver?(0,jsx_runtime.jsx)(modern.Button,{size:"xs",view:"secondary",onClick:handleRepeatSmsButtonClick,className:overlimit_index_module_getCodeButton,children:buttonRetryText}):(0,jsx_runtime.jsxs)("div",{className:overlimit_index_module_countdown,children:[(0,jsx_runtime.jsx)(CountdownLoader,{progress:progress,className:overlimit_index_module_loader}),(0,jsx_runtime.jsx)("div",{className:overlimit_index_module_timePassed,children:formatMsAsMinutes(duration-timePassed)})]})]})]})};try{Overlimit.displayName="Overlimit",Overlimit.__docgenInfo={description:"",displayName:"Overlimit",props:{duration:{defaultValue:{value:"60000"},description:"",name:"duration",required:!1,type:{name:"number"}},buttonRetryText:{defaultValue:null,description:"",name:"buttonRetryText",required:!0,type:{name:"string"}},hasFatalError:{defaultValue:null,description:"",name:"hasFatalError",required:!0,type:{name:"boolean"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},onOverlimitCountdownFinished:{defaultValue:null,description:"",name:"onOverlimitCountdownFinished",required:!0,type:{name:"() => void"}},onOverlimitRepeatSms:{defaultValue:null,description:"",name:"onOverlimitRepeatSms",required:!0,type:{name:"(event: MouseEvent<Element, MouseEvent>) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/confirmation-v1/src/components/overlimit/component.tsx#Overlimit"]={docgenInfo:Overlimit.__docgenInfo,name:"Overlimit",path:"packages/confirmation-v1/src/components/overlimit/component.tsx#Overlimit"})}catch(__react_docgen_typescript_loader_error){}}}]);