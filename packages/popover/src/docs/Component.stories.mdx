import { Meta, Story } from '@storybook/addon-docs';
import { text, boolean, select, number } from '@storybook/addon-knobs';
import { ComponentHeader, Tabs } from 'storybook/blocks';
import { ModeChecker } from 'storybook/components/mode-checker';

import { Button } from '@alfalab/core-components-button';
import { Popover } from '@alfalab/core-components-popover';

import { name, version } from '../../package.json';
import Description from './description.mdx';
import Development from './development.mdx';
import Changelog from '../../CHANGELOG.md';
import {
    getQueryParam,
    stylesStringToObj,
} from '../../../screenshot-utils/screenshots-story/utils';

<Meta title='Components/Popover' component={Popover} id='Popover' />

<!-- Canvas -->

<Story name='Popover'>
    {React.createElement(() => {
        const POSITION_OPTIONS = [
            'top',
            'top-start',
            'top-end',
            'bottom',
            'bottom-start',
            'bottom-end',
            'right',
            'right-start',
            'right-end',
            'left',
            'left-start',
            'left-end',
        ];
        const [open, setOpen] = React.useState(false);
        const [buttonElement, setButtonElement] = React.useState(null);
        const toggle = () => {
            setOpen(!open);
        };
        const handleRef = (node) => {
            setButtonElement(node);
        };
        const transitionTimeout = number('transition.timeout (ms)', 150);
        const previewStyles = stylesStringToObj(getQueryParam('wrapperStyles'));
        const isPreview = Object.keys(previewStyles).length > 0;
        return (
            <div
                style={
                    isPreview
                        ? previewStyles
                        : {
                              width: '100%',
                              height: '300px',
                              display: 'flex',
                              justifyContent: 'center',
                              alignItems: 'center',
                          }
                }
            >
                <ModeChecker />
                <style>{`.popover {border-radius: 8px}`}</style>
                <Popover
                    anchorElement={buttonElement}
                    popperClassName='popover'
                    useAnchorWidth={boolean('useAnchorWidth', false)}
                    position={select('position', POSITION_OPTIONS, 'bottom')}
                    open={open || boolean('open', false)}
                    transition={{ timeout: transitionTimeout }}
                    offset={[number('offset[0]', 0), number('offset[1]', 0)]}
                    withArrow={boolean('withArrow', false)}
                    withTransition={boolean('withTransition', true)}
                >
                    <div
                        style={
                            isPreview
                                ? { width: 420, height: 380 }
                                : { padding: '15px', width: '156px' }
                        }
                    >
                        {isPreview ? '' : 'I am popover'}
                    </div>
                </Popover>
                {isPreview ? (
                    <div ref={handleRef} />
                ) : (
                    <Button ref={handleRef} onClick={toggle}>
                        {open ? 'Скрыть' : 'Показать'} Popover
                    </Button>
                )}
            </div>
        );
    })}
</Story>

<!-- Docs -->

<ComponentHeader
    name='Popover'
    version={version}
    package='@alfalab/core-components/popover'
    children='Используется для отображения выпадающих списков и тултипов.'
/>

<Tabs description={<Description />} development={<Development />} changelog={<Changelog />} />
