import { Meta, Story, Markdown } from '@storybook/addon-docs';
import { text, select, number } from '@storybook/addon-knobs';
import { ComponentHeader, Tabs } from 'storybook/blocks';

import { Tooltip } from '@alfalab/core-components-tooltip';
import { TooltipResponsive } from '@alfalab/core-components-tooltip/responsive';

import packageJson from '../../package.json';
import Description from './description.mdx';
import Development from './development.mdx';
import Changelog from '../../CHANGELOG.md?raw';
import {
    getQueryParam,
    stylesStringToObj,
} from '../../../screenshot-utils/screenshots-story/utils';

<Meta title='Components/Tooltip' component={Tooltip} id='Tooltip' />

{/* Canvas */}

<Story name='Tooltip'>
    {React.createElement(() => {
        const POSITION_OPTIONS = [
            'top',
            'top-start',
            'top-end',
            'bottom',
            'bottom-start',
            'bottom-end',
            'right',
            'right-start',
            'right-end',
            'left',
            'left-start',
            'left-end',
        ];
        const openSelectValue = select('open', ['true', 'false', 'undefined'], 'undefined');
        const open =
            openSelectValue === 'false' ? false : openSelectValue === 'true' ? true : undefined;
        const trigger = select('trigger', ['hover', 'click'], 'hover');
        const previewStyles = stylesStringToObj(getQueryParam('wrapperStyles'));
        const isPreview = Object.keys(previewStyles).length > 0;
        return (
            <div
                style={
                    isPreview
                        ? previewStyles
                        : {
                              width: '100%',
                              height: '300px',
                              display: 'flex',
                              justifyContent: 'center',
                              alignItems: 'center',
                          }
                }
            >
                <style>{`.popover > div{transform:scale(2)}  `}</style>
                <Tooltip
                    content={
                        <div
                            style={
                                isPreview
                                    ? {
                                          display: 'flex',
                                          justifyContent: 'center',
                                          alignItems: 'center',
                                      }
                                    : { width: '215px' }
                            }
                        >
                            {isPreview
                                ? 'Подсказка'
                                : 'Теперь вам можно снимать наличные в кассе и банкоматах, если ваш тариф это позволяет'}
                        </div>
                    }
                    popoverClassName={isPreview ? 'popover' : undefined}
                    open={open}
                    trigger={trigger}
                    offset={[number('offset[0]', 0), number('offset[1]', 16)]}
                    position={select('position', POSITION_OPTIONS, 'left')}
                    onCloseDelay={number('onCloseDelay (in ms)', 300)}
                    onOpenDelay={number('onOpenDelay (in ms)', 300)}
                    view={select('view', ['tooltip', 'hint'], 'tooltip')}
                    colors={select('colors', ['default', 'inverted'], 'default')}
                    dataTestId='test-id'
                >
                    {isPreview ? (
                        <div />
                    ) : (
                        <div style={{ padding: '15px', border: '1px dashed rgba(0, 0, 0, 0.1)' }}>
                            {trigger === 'hover' ? 'Hover me' : 'Click me'}
                        </div>
                    )}
                </Tooltip>
            </div>
        );
    })}
</Story>

<Story name='TooltipResponsive'>
    {React.createElement(() => {
        const [open, setOpen] = React.useState(false);
        const handleOpen = () => {
            setOpen(true);
        };
        const handleClose = () => {
            setOpen(false);
        };
        const POSITION_OPTIONS = [
            'top',
            'top-start',
            'top-end',
            'bottom',
            'bottom-start',
            'bottom-end',
            'right',
            'right-start',
            'right-end',
            'left',
            'left-start',
            'left-end',
        ];
        return (
            <div
                style={{
                    width: '100%',
                    height: '300px',
                    display: 'flex',
                    justifyContent: 'center',
                    alignItems: 'center',
                }}
            >
                <TooltipResponsive
                    open={open}
                    content={<div>Tooltip Responsive</div>}
                    trigger={select('trigger', ['hover', 'click'], 'hover')}
                    offset={[number('offset[0]', 0), number('offset[1]', 16)]}
                    position={select('position', POSITION_OPTIONS, 'left')}
                    onOpen={handleOpen}
                    onClose={handleClose}
                    fallbackPlacements={['bottom', 'top']}
                    actionButtonTitle={text('title', 'Хорошо')}
                    view={select('view', ['tooltip', 'hint'], 'tooltip')}
                    hasCloser={select('hasCloser', [true, false], false)}
                >
                    <div style={{ padding: '15px', border: '1px dashed rgba(0, 0, 0, 0.1)' }}>
                        Подробнее
                    </div>
                </TooltipResponsive>
            </div>
        );
    })}
</Story>

{/* Docs */}

<ComponentHeader
    name='Tooltip'
    version={packageJson.version}
    package='@alfalab/core-components/tooltip'
    design='https://www.figma.com/file/cdNnkh2QdxuvYLrBm4cubM/Web-%3A%3A-Core-Default-Components?node-id=298%3A37393'
/>

<Tabs
    description={<Description />}
    changelog={<Markdown>{Changelog}</Markdown>}
    development={<Development />}
/>