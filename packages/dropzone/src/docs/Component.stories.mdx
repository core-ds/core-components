import { Meta, Story, ArgsTable, Markdown } from '@storybook/addon-docs';
import { boolean } from '@storybook/addon-knobs';
import { ComponentHeader, Tabs } from 'storybook/blocks';
import { Dropzone } from '@alfalab/core-components-dropzone';

import { Dropzone as DropzoneTS } from '../Component';
import packageJson from '../../package.json';
import Changelog from '../../CHANGELOG.md?raw';
import Description from './description.mdx';
import {
    getQueryParam,
    stylesStringToObj,
} from '../../../screenshot-utils/screenshots-story/utils';

<Meta title='Components/Dropzone' component={Dropzone} id='Dropzone' />

export const WRAPPER_STYLES = {
    display: 'inline-block',
    background: 'var(--color-light-bg-primary)',
};

{/* Canvas */}

<Story name='Dropzone'>
    {React.createElement(() => {
        const [filesList, setFilesList] = React.useState([]);
        const handleDrop = (files) => {
            setFilesList(
                Array.from(files)
                    .map((file) => file.name)
                    .filter(Boolean),
            );
        };
        return (
            <div
                style={{
                    display: 'inline-block',
                    ...stylesStringToObj(getQueryParam('wrapperStyles')),
                }}
            >
                <div style={WRAPPER_STYLES}>
                    <Dropzone
                        error={boolean('error', false)}
                        block={boolean('block', false)}
                        overlayVisible={boolean('overlayVisible (deprecated)', undefined)}
                        disabled={boolean('disabled', false)}
                        onDrop={handleDrop}
                    >
                        <div
                            style={{
                                minWidth: 400,
                                width: '100%',
                                height: 200,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                            }}
                        >
                            {filesList.length > 0 ? (
                                <ul>
                                    {filesList.map((file) => (
                                        <li key={file}>{file}</li>
                                    ))}
                                </ul>
                            ) : (
                                <span>Перетащите файлы</span>
                            )}
                        </div>
                    </Dropzone>
                </div>
            </div>
        );
    })}
</Story>

{/* Docs */}

<ComponentHeader
    name='Dropzone'
    version={packageJson.version}
    package='@alfalab/core-components/dropzone'
    design='https://www.figma.com/file/cdNnkh2QdxuvYLrBm4cubM/Web-%3A%3A-Core-Default-Components?node-id=8897%3A54579'
/>

```jsx
import { Dropzone } from '@alfalab/core-components/dropzone';
```

<Tabs
    description={<Description />}
    props={<ArgsTable of={DropzoneTS} />}
    changelog={<Markdown>{Changelog}</Markdown>}
/>
